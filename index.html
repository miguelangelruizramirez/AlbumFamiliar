<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>√Ålbum Familiar</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
  header { background:#222; color:#fff; text-align:center; padding:25px 15px; }
  header h1 { margin:0; font-size:2rem; }
  .intro { max-width:800px; margin:20px auto; padding:0 20px; color:#444; text-align:center; }
  .gallery, .video-grid {
    display:grid;
    gap:10px;
    padding:15px;
  }
  .gallery { grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); }
  .gallery-item img { width:100%; height:180px; object-fit:cover; border-radius:8px; transition:0.3s; }
  .gallery-item img:hover { transform: scale(1.05); box-shadow:0 4px 12px rgba(0,0,0,0.2); }
  .video-grid { grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); }
  .video-grid video { width:100%; height:160px; border-radius:10px; object-fit:cover; box-shadow:0 2px 8px rgba(0,0,0,0.15); cursor:pointer; transition:transform 0.3s; }
  .video-grid video:hover { transform: scale(1.04); }
  .lightbox {
    position:fixed; inset:0;
    background: rgba(0,0,0,0.85);
    display:none; justify-content:center; align-items:center;
    z-index:999; padding:20px;
  }
  .lightbox-content { max-width:90%; max-height:85%; }
  .lightbox-content img, .lightbox-content video { width:100%; height:auto; border-radius:10px; }
  .lightbox span {
    position:absolute; top:20px; right:35px;
    color:white; font-size:40px; cursor:pointer;
  }
</style>
</head>
<body>
  <header>
    <h1>üì∏ √Ålbum Familiar ‚Äî Miguel</h1>
  </header>

  <div class="intro">
    <p>Este √°lbum refleja recuerdos, lucha, esperanza, fe y amor para mi hijo y mi familia.</p>
  </div>

  <div class="gallery" id="gallery"></div>
  <div class="videos-section">
    <h2 style="margin-left:15px;">Videos üé•</h2>
    <div class="video-grid" id="video-grid"></div>
  </div>

  <div class="lightbox" id="lightbox">
    <span onclick="closeLightbox()">&times;</span>
    <div class="lightbox-content" id="lightbox-content"></div>
  </div>

<script>
// --- UTILS ---
async function fetchDirContents(path) {
  const api = `https://api.github.com/repos/KATO250712/AlbumFamiliar/contents/${path}`;
  const res = await fetch(api);
  if (!res.ok) return [];
  return await res.json();
}

function sortByDateOrName(a, b) {
  // intenta usar fecha de commit (si disponible) o nombre
  // por ahora: orden alfab√©tico
  return a.name.localeCompare(b.name);
}

// --- RECURSIVO ---
async function walkDir(path, files = []) {
  const entries = await fetchDirContents(path);
  for (const entry of entries) {
    if (entry.type === "dir") {
      await walkDir(path + "/" + entry.name, files);
    } else if (entry.type === "file") {
      files.push(entry);
    }
  }
  return files;
}

// --- CARGAR IM√ÅGENES ---
async function loadImages() {
  const files = await walkDir("fotos");
  const gallery = document.getElementById("gallery");
  files.sort(sortByDateOrName);
  files.forEach(file => {
    if (file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
      const div = document.createElement("div");
      div.classList.add("gallery-item");
      div.innerHTML = `<img src="${file.download_url}" alt="">`;
      div.onclick = () => openLightbox("img", file.download_url);
      gallery.appendChild(div);
    }
  });
}

// --- CARGAR VIDEOS ---
async function loadVideos() {
  const files = await walkDir("videos");
  const vg = document.getElementById("video-grid");
  files.sort(sortByDateOrName);
  files.forEach(file => {
    if (file.name.match(/\.(mp4|webm|mov)$/i)) {
      const video = document.createElement("video");
      video.src = file.download_url;
      video.muted = true;
      video.loop = true;
      video.onclick = () => openLightbox("video", file.download_url);
      vg.appendChild(video);
    }
  });
}

// --- LIGHTBOX ---
function openLightbox(type, src) {
  const content = document.getElementById("lightbox-content");
  content.innerHTML = type === "img"
    ? `<img src="${src}">`
    : `<video src="${src}" controls autoplay></video>`;
  document.getElementById("lightbox").style.display = "flex";
}
function closeLightbox() {
  document.getElementById("lightbox").style.display = "none";
  document.getElementById("lightbox-content").innerHTML = "";
}

// --- INIT ---
loadImages();
loadVideos();
</script>

<footer style="text-align:center; padding:15px; color:#666; margin-top:25px;">
  <p>"Todo lo que te viniere a la mano para hacer, hazlo seg√∫n tus fuerzas." ‚Äî Eclesiast√©s 9:10</p>
  <p>Conservar recuerdos familiares de la manera m√°s segura y accesible.</p>
  <p>By Miguel Angel Ruiz</p>
</footer>
</body>
</html>
